# Служебные bat-скрипты

В этой папке лежат вспомогательные скрипты для подготовки окружения и запуска выгрузки IFC.

## 1. Установка openpyxl (основной вариант)

**Файл:** `install_openpyxl_pip_or_whl.bat`  

Что делает:
- Проверяет, установлен ли пакет `openpyxl` в текущем Python.
- Пытается установить `openpyxl` через `pip install openpyxl`.
- Если интернет недоступен или `pip` не сработал — ставит `openpyxl` из локальных `.whl`
  из каталога `_for_python/openpyxl` в корне проекта.

Когда запускать:
- При первичной настройке рабочего места.
- После установки/смены версии Python.
- Если скрипт выгрузки IFC жалуется, что нет `openpyxl`.

---

## 2. Установка openpyxl (жёсткий офлайн-вариант)

**Файл:** `openpyxl_offline_install/install_openpyxl_zip.bat`  

Что делает:
- Распаковывает архив `_for_python/openpyxl.zip` прямо в `site-packages` текущего Python.
- Используется только тогда, когда:
  - нет интернета **и**
  - не сработал основной скрипт `install_openpyxl_pip_or_whl.bat`.

Когда запускать:
- Как крайний вариант, по инструкции:
  1. Убедиться, что в корне проекта есть `_for_python/openpyxl.zip`.
  2. Запустить `openpyxl_offline_install/install_openpyxl_zip.bat`.

Подробное описание этого варианта установки — в
[README по офлайн-установке openpyxl](openpyxl_offline_install/README.md).


---

### Как убедиться, что `openpyxl` установлен

После успешного запуска одного из скриптов установки `openpyxl`
(`install_openpyxl_pip_or_whl.bat` или `openpyxl_offline_install/install_openpyxl_zip.bat`)
можно проверить установку так.

В командной строке выполните одну из команд:

```bash
py -3 -m pip show openpyxl
```
или
```bash
py -3 -c "import openpyxl; print(openpyxl.__version__)"
```

Если ошибок нет и выводится информация о пакете и его версии — значит, `openpyxl` установлен корректно.

---

## 3. Подключение pyRevit ко всем Revit

**Файл:** `attach_pyrevit_engine_all_revit.bat`  

Что делает:
- Проверяет доступность команды `pyrevit`.
- Подключает указанный набор pyRevit (`master`) и движок IronPython (`342`)
  ко всем установленным версиям Revit (`--installed`).

Когда запускать:
- После установки pyRevit.
- После переустановки Revit.
- При смене движка/набора pyRevit (если менялись настройки в bat-файле).

Требования:
- Установлен pyRevit.
- Команда `pyrevit` доступна в PATH (запускается из обычной командной строки).

---

## 4. Запуск выгрузки IFC

**Файл:** `run_export_ifc.bat`  

Что делает:
- Находит `main.py` в корне проекта.
- Запускает основной сценарий выгрузки IFC через выбранный Python,
  используя настройки из `_settings\settings.ini` и таблиц в `admin_data`.

Когда запускать:
- Для запуска основного процесса автоматической выгрузки IFC — вручную
  или из Планировщика заданий Windows. Предполагается, что окружение
  уже полностью настроено по инструкции
  [ExportIFC_manual](../../_docs/ExportIFC_manual.md)
  (папки конфигов, `admin_data`, Revit, Python и т.п.).
- После того как:
  - установлен Python,
  - установлены нужные версии Revit,
  - настроен pyRevit (при необходимости),
  - установлен `openpyxl` (через один из скриптов выше).

Если `main.py` не найден или Python отрабатывает с ошибкой — это будет видно в окне консоли.

