# Папка `_settings`

Служебные файлы и настройки, которые нужны для работы ExportIFC.

## Состав

- **`settings.ini`**  
  Основной конфигурационный файл проекта. Здесь задаются:

  - пути к папкам:
    - `dir_export_config` — корень конфигов IFC (копия `IFC_Export_Config_example`);
    - `dir_admin_data` — папка `admin_data` с Excel-файлами управления;

  - файловые настройки:
    - `config_json` — базовое имя JSON-файлов настроек экспорта IFC;

  - общие флаги работы:
    - `is_prod_mode` — рабочий / тестовый режим;  
      при `True` папка `admin_data` берётся по пути из `dir_admin_data`,  
      при `False` — из локальной копии репозитория (`admin_data` рядом со скриптами проекта).
    - `enable_unmapped_export` — делать ли дополнительную выгрузку без маппинга;

  - настройки Revit:
    - `revit_versions` — список поддерживаемых версий Revit;
    - `export_view3d_name` — имя 3D-вида, используемого для экспорта;

  - листы в Excel:
    - `sheet_path` — лист с путями и настройками по проектам (`manage.xlsx`);
    - `sheet_ignore` — лист с игнорируемыми путями (`manage.xlsx`);
    - `sheet_history` — лист истории выгрузок (`history.xlsx`);

  - структура папок конфигов:
    - `dir_common` — папка с общими настройками (`00_Common`);
    - `dir_layers` — папка с файлами маппинга категорий (`01_Export_Layers`).

- **Папка `bat`**  
  Служебные bat-скрипты:
  - установка `openpyxl` (через `pip` или офлайн);
  - подключение pyRevit ко всем установленным Revit;
  - запуск основного сценария выгрузки IFC.  

  Подробное описание — в `_settings/bat/README.md`.

- **Папка `ApiIFCExporter`**
  Служебная папка с единственным файлом `Autodesk.IFC.Export.UI.dll`.  
  Этот DLL нужен только для импорта в коде:

  `from BIM.IFC.Export.UI import IFCExportConfiguration`

  По умолчанию `Autodesk.IFC.Export.UI.dll` устанавливается вместе с IFC Exporter
  и лежит в папке соответствующей версии Revit, например:

  `C:\Program Files\Autodesk\Revit 2022\AddIns\IFCExporterUI`  
  или папка нужной версии Revit, например  
  `C:\Program Files\Autodesk\Revit 20XX\AddIns\IFCExporterUI`

  Чтобы не привязываться к конкретным путям и версиям Revit,
  нужный DLL **копируется сюда вручную** из папки `AddIns\IFCExporterUI`
  старшей установленной версии Revit на машине, где выполняется выгрузка IFC.

  > Папку `ApiIFCExporter` и имя файла `Autodesk.IFC.Export.UI.dll`
  > **нельзя переименовывать**, иначе импорт в коде перестанет работать.

## Связь с основной документацией

- Краткая установка и первый запуск описаны в разделе «Quick start» корневого
  [README репозитория](../README.md); перечень параметров `settings.ini` и назначение
  `admin_data` должны совпадать с тем, что указано там.
- Развёрнутые требования к окружению и подробное описание всех полей
  `settings.ini` — в [ExportIFC_manual](../_docs/ExportIFC_manual.md)
  (Раздел 6). При доработке `settings.ini` или структуры конфигов важно
  держать этот файл и мануал в одном состоянии.
- Сценарии установки `openpyxl`, подключения pyRevit и запуска экспорта
  детализированы в [README по bat-скриптам](bat/README.md);

## Кто и что здесь трогает

- Рядовые пользователи/моделировщики **не работают** с папкой `_settings` и исходным кодом.
  Запуск выгрузки для них выполняется:
  - либо автоматически по расписанию (через Планировщик заданий Windows);
  - либо через заранее настроенный ярлык/отдельный bat-файл вне папки `_settings`.

- Ответственный за проект (BIM-координатор / админ) настраивает:
  - значения в `settings.ini` под инфраструктуру компании;
  - содержимое папки с конфигами IFC (см.
    [Описание структуры конфигов IFC](../_examples/IFC_Export_Config_structure.md)
    и `_examples/IFC_Export_Config_structure_notes_ru.docx`);
  - bat-скрипты в `_settings\bat` (пути, версии Python/Revit, при необходимости —
    правки под конкретную среду).

> Важно: папки и файлы внутри `_settings` (включая `ApiIFCExporter`, `settings.ini` и др.)
> нельзя произвольно перемещать или переименовывать — их имена и расположение
> жёстко используются в коде и bat-скриптах.  
> Папку `bat` технически можно переименовать, но это **не рекомендуется**:
> во всей документации и примерах она рассматривается именно как `_settings\bat`.
